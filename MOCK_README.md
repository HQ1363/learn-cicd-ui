# Mock æ•°æ®ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²é…ç½®å®Œæ•´çš„ Mock æ•°æ®ç³»ç»Ÿï¼Œç”¨äºå¼€å‘ç¯å¢ƒç»•è¿‡ç™»å½•é™åˆ¶å’Œåç«¯ API ä¾èµ–ã€‚

## åŠŸèƒ½ç‰¹æ€§

âœ… **è‡ªåŠ¨å¯ç”¨**: å¼€å‘ç¯å¢ƒï¼ˆ`NODE_ENV=development`ï¼‰è‡ªåŠ¨å¯ç”¨ Mock æ¨¡å¼
âœ… **å…¨å±€æ‹¦æˆª**: æ‹¦æˆªæ‰€æœ‰ API è¯·æ±‚ï¼ˆåŒ…æ‹¬ tiklab-core-ui çš„ Axiosï¼‰
âœ… **æ— éœ€ç™»å½•**: è‡ªåŠ¨æ³¨å…¥ Mock ç”¨æˆ·ä¿¡æ¯
âœ… **å®Œæ•´æ•°æ®**: é¢„ç½®å¸¸ç”¨ä¸šåŠ¡æ•°æ®
âœ… **å¯æ‰©å±•**: è½»æ¾æ·»åŠ æ–°çš„ Mock æ•°æ®

## å·²å®ç°çš„åŠŸèƒ½

### 1. ç™»å½•ç»•è¿‡
- âœ… ç§»é™¤ `UserVerify` éªŒè¯
- âœ… è‡ªåŠ¨æ³¨å…¥ Mock ç”¨æˆ·ï¼ˆuserId: dev-user-001ï¼‰
- âœ… æ¨¡æ‹Ÿç”¨æˆ·æƒé™

### 2. API Mock
å·² Mock çš„ API åŒ…æ‹¬ï¼š
- æµæ°´çº¿ç®¡ç†ï¼ˆPipelineï¼‰
- ç¯å¢ƒç®¡ç†ï¼ˆEnvironmentï¼‰
- å˜é‡ç®¡ç†ï¼ˆVariableï¼‰
- Agent ç®¡ç†
- æˆæƒç®¡ç†ï¼ˆAuthï¼‰
- ä¸»æœºç®¡ç†ï¼ˆHostï¼‰
- æœåŠ¡å™¨é…ç½®ï¼ˆServerï¼‰
- å·¥å…·ç®¡ç†ï¼ˆToolï¼‰
- K8s é…ç½®
- ç”¨æˆ·ç®¡ç†ï¼ˆUserï¼‰
- è§’è‰²æƒé™ï¼ˆRoleï¼‰
- æ¶ˆæ¯é€šçŸ¥ï¼ˆMessageï¼‰
- å†å²è®°å½•ï¼ˆHistoryï¼‰
- æµ‹è¯•æŠ¥å‘Šï¼ˆTestï¼‰
- åŠ¨æ€æ¶ˆæ¯ï¼ˆDynamicï¼‰
- æ¦‚è§ˆæ•°æ®ï¼ˆOverviewï¼‰
- ... æ›´å¤š

## æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶

1. **`src/common/utils/MockData.js`**
   - Mock æ•°æ®å®šä¹‰æ–‡ä»¶
   - åŒ…å«æ‰€æœ‰ API çš„ Mock å“åº”æ•°æ®

2. **`src/common/utils/InitMock.js`**
   - Mock åˆå§‹åŒ–æ¨¡å—
   - æ‹¦æˆª tiklab-core-ui çš„ Axios è¯·æ±‚

3. **`src/common/utils/MockAxios.js`**
   - Mock Axios å®ä¾‹
   - å¤‡ç”¨æ‹¦æˆªå™¨

4. **`src/common/utils/Requset.js`**
   - è¯·æ±‚æ‹¦æˆªå™¨
   - å¤„ç† axios åŸç”Ÿè¯·æ±‚

5. **`src/common/layout/Layout.js`**
   - å·²ç§»é™¤ç™»å½•éªŒè¯ï¼ˆUserVerifyï¼‰

6. **`src/common/layout/Portal.js`**
   - è‡ªåŠ¨æ³¨å…¥ Mock ç”¨æˆ·ä¿¡æ¯

## å¦‚ä½•ä½¿ç”¨

### 1. å¯åŠ¨é¡¹ç›®

```bash
# ä½¿ç”¨ yarn
yarn run arbess-start

# æˆ–ä½¿ç”¨ npm
npm run arbess-start
```

### 2. æŸ¥çœ‹ Mock æ—¥å¿—

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°ï¼š
```
[Mock] ğŸ­ å¯ç”¨ Mock æ¨¡å¼ï¼Œæ‰€æœ‰ API è¯·æ±‚å°†è¿”å› Mock æ•°æ®
[Mock] âœ… Mock æ‹¦æˆªå™¨åˆå§‹åŒ–å®Œæˆ
[Mock] æ‹¦æˆª POST è¯·æ±‚: /pipeline/findPipelineList
[Mock] è¿”å› Mock æ•°æ®: {code: 0, msg: 'success', data: [...]}
```

### 3. ç¦ç”¨ Mockï¼ˆå¦‚éœ€æµ‹è¯•çœŸå® APIï¼‰

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
window.__restoreMock()
```

## æ·»åŠ æ–°çš„ Mock æ•°æ®

### æ–¹æ³• 1: ç²¾ç¡®åŒ¹é…

åœ¨ `src/common/utils/MockData.js` çš„ `mockDataMap` ä¸­æ·»åŠ ï¼š

```javascript
const mockDataMap = {
    // ... ç°æœ‰é…ç½®
    
    // æ·»åŠ æ–°çš„ API Mock
    '/yourapi/findList': () => successResponse([
        { id: '1', name: 'æµ‹è¯•æ•°æ®1' },
        { id: '2', name: 'æµ‹è¯•æ•°æ®2' }
    ]),
    
    '/yourapi/findPage': () => pageResponse([
        { id: '1', name: 'æµ‹è¯•æ•°æ®' }
    ], 1),
};
```

### æ–¹æ³• 2: ä½¿ç”¨é»˜è®¤è§„åˆ™

å¦‚æœä¸é…ç½®ç²¾ç¡®åŒ¹é…ï¼Œç³»ç»Ÿä¼šæ ¹æ® URL è‡ªåŠ¨å¤„ç†ï¼š
- åŒ…å« `/create` â†’ è¿”å›åˆ›å»ºæˆåŠŸ
- åŒ…å« `/update` â†’ è¿”å›æ›´æ–°æˆåŠŸ
- åŒ…å« `/delete` â†’ è¿”å›åˆ é™¤æˆåŠŸ
- åŒ…å« `/findPage` â†’ è¿”å›ç©ºåˆ†é¡µ
- åŒ…å« `/findList` â†’ è¿”å›ç©ºæ•°ç»„
- åŒ…å« `/get` â†’ è¿”å›ç©ºå¯¹è±¡

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¢«æ‹¦æˆªçš„è¯·æ±‚
æ‰“å¼€æ§åˆ¶å°ï¼Œæœç´¢ `[Mock]` æŸ¥çœ‹æ‰€æœ‰è¢«æ‹¦æˆªçš„è¯·æ±‚

### 2. æ£€æŸ¥è¿”å›çš„æ•°æ®
åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ¯ä¸ªè¯·æ±‚è¿”å›çš„ Mock æ•°æ®

### 3. ä¸´æ—¶ç¦ç”¨ Mock
ä¿®æ”¹ `src/common/utils/InitMock.js`:
```javascript
const USE_MOCK = false; // æ”¹ä¸º false
```

### 4. é’ˆå¯¹ç‰¹å®š API ä½¿ç”¨çœŸå®æ•°æ®
åœ¨ `getMockData` å‡½æ•°ä¸­æ·»åŠ åˆ¤æ–­ï¼š
```javascript
export const getMockData = (url, data) => {
    // ç‰¹å®š API è¿”å›ç‰¹æ®Šæ ‡è®°ï¼Œè®©è°ƒç”¨æ–¹ä½¿ç”¨çœŸå®è¯·æ±‚
    if (url === '/special/api') {
        return { __useMock: false };
    }
    // ... å…¶ä»–é€»è¾‘
};
```

## æ³¨æ„äº‹é¡¹

1. **ä»…å¼€å‘ç¯å¢ƒ**: Mock æ¨¡å¼ä»…åœ¨ `NODE_ENV=development` æ—¶å¯ç”¨
2. **ç½‘ç»œå»¶è¿Ÿ**: Mock è¯·æ±‚æœ‰ 100ms å»¶è¿Ÿï¼Œæ¨¡æ‹ŸçœŸå®ç½‘ç»œ
3. **æ•°æ®æŒä¹…åŒ–**: Mock æ•°æ®ä¸ä¼šæŒä¹…åŒ–ï¼Œåˆ·æ–°é¡µé¢åé‡ç½®
4. **æƒé™æ§åˆ¶**: å½“å‰ Mock ç”¨æˆ·æ‹¥æœ‰æ‰€æœ‰æƒé™

## ç”Ÿäº§ç¯å¢ƒ

ç”Ÿäº§ç¯å¢ƒæ„å»ºæ—¶ï¼ˆ`npm run prod`ï¼‰ï¼ŒMock ä»£ç ä¼šè¢«è‡ªåŠ¨æ’é™¤ï¼Œä¸å½±å“ç”Ÿäº§åŒ…å¤§å°ã€‚

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæŸäº› API è¿˜æ˜¯æŠ¥é”™ï¼Ÿ
A: æ£€æŸ¥æ§åˆ¶å°ï¼Œç¡®è®¤è¯¥ API æ˜¯å¦è¢«æ‹¦æˆªã€‚å¦‚æœªæ‹¦æˆªï¼Œæ·»åŠ åˆ° `MockData.js` ä¸­ã€‚

### Q: å¦‚ä½•ä¿®æ”¹ Mock ç”¨æˆ·ä¿¡æ¯ï¼Ÿ
A: ä¿®æ”¹ `src/common/layout/Portal.js` ä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼š
```javascript
localStorage.setItem('user', JSON.stringify({
    userId: 'custom-user-id',
    name: 'è‡ªå®šä¹‰ç”¨æˆ·å',
    // ... å…¶ä»–å­—æ®µ
}));
```

### Q: Mock æ•°æ®å¦‚ä½•æ”¯æŒå¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Ÿ
A: åœ¨ `MockData.js` ä¸­ï¼Œå¯ä»¥æ ¹æ®è¯·æ±‚å‚æ•°è¿”å›ä¸åŒæ•°æ®ï¼š
```javascript
'/api/findByStatus': (data) => {
    const status = data?.status;
    if (status === 'active') {
        return successResponse([/* æ´»è·ƒæ•°æ® */]);
    }
    return successResponse([/* å…¶ä»–æ•°æ® */]);
}
```

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°çš„ Mock æ—¥å¿—
2. ç½‘ç»œé¢æ¿ï¼ˆç¡®è®¤è¯·æ±‚æœªå‘é€åˆ°æœåŠ¡å™¨ï¼‰
3. æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†

